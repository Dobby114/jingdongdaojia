"use strict";(self["webpackChunkjingdong"]=self["webpackChunkjingdong"]||[]).push([[32],{7086:function(s,c,t){t.d(c,{r:function(){return e}});var a=t(2262),o=t(3907);const e=()=>{const s=(0,o.oR)(),c=(c,t,a,o)=>{s.commit("changeCount",{shopId:c,productId:t,productInfo:a,num:o})},{cartList:t}=(0,a.BK)(s.state);return{cartList:t,changeCount:c}}},2186:function(s,c,t){t.d(c,{Z:function(){return h},S:function(){return i}});var a=t(6252),o=t(3577);const e={class:"toast"};function l(s,c,t,l,n,i){return(0,a.wg)(),(0,a.iD)("div",e,(0,o.zw)(t.toastMessa),1)}var n=t(2262);const i=()=>{const s=(0,n.qj)({show:!1,toastMessa:""}),c=c=>{s.show=!0,s.toastMessa=c,setTimeout((()=>{s.show=!1,s.toastMessa=""}),2e3)},{show:t,toastMessa:a}=(0,n.BK)(s);return{show:t,toastMessa:a,showToast:c}};var r={name:"Toast",props:["toastMessa"]},d=t(3744);const u=(0,d.Z)(r,[["render",l],["__scopeId","data-v-6d51e152"]]);var h=u},2320:function(s,c,t){t.r(c),t.d(c,{default:function(){return B}});var a=t(6252),o=t(3577),e=t(9963);const l=s=>((0,a.dD)("data-v-71024647"),s=s(),(0,a.Cn)(),s),n={class:"container"},i=l((()=>(0,a._)("div",{class:"topbackground"},null,-1))),r={class:"wrappar"},d={class:"header"},u={class:"themes"},h=(0,a.uE)('<div class="address" data-v-71024647><div class="address__info" data-v-71024647><h3 data-v-71024647>收货地址</h3><p class="address__info__text" data-v-71024647>上海大学延长校区行健楼10层技园2号楼10层</p><p class="address__info__concact" data-v-71024647>牛牛(先生) 1234556767</p></div><div class="iconfont address__organize" data-v-71024647></div></div>',1),p={class:"content"},_={class:"shopname"},k=["src"],v={class:"info"},C={class:"price"},w={class:"price__now"},m={class:"allprice"},g=["innerHTML"],f={class:"footer"},y={class:"allprice"},S={class:"mask"},I={class:"confirm"},b=l((()=>(0,a._)("h3",null,"确认要离开收银台？",-1))),M=l((()=>(0,a._)("p",null,"请尽快完成支付，否则将被取消",-1))),H={class:"chose"},L={class:"paysuccess"},z=l((()=>(0,a._)("div",{class:"iconfont yes"},"",-1))),F=l((()=>(0,a._)("div",{class:"prompt"},"支付成功，等待配送",-1)));function P(s,c,t,l,P,T){const D=(0,a.up)("router-link"),A=(0,a.up)("Toast");return(0,a.wg)(),(0,a.iD)("div",n,[i,(0,a._)("div",r,[(0,a._)("div",d,[(0,a._)("div",u,[(0,a.Wm)(D,{to:`/shop/${l.shopId}`,class:"iconfont"},{default:(0,a.w5)((()=>[(0,a.Uk)("")])),_:1},8,["to"]),(0,a.Uk)("确认订单")]),h]),(0,a._)("div",p,[(0,a._)("h3",_,(0,o.zw)(l.shopId),1),(0,a._)("ul",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.products,(s=>(0,a.wy)(((0,a.wg)(),(0,a.iD)("li",{key:s._id},[(0,a._)("img",{src:s.imgUrl,alt:""},null,8,k),(0,a._)("div",v,[(0,a._)("h3",null,(0,o.zw)(s.name?s.name:""),1),(0,a._)("div",C,[(0,a._)("div",w,(0,o.zw)(s.price)+" x "+(0,o.zw)(s.count),1)])]),(0,a._)("div",m,(0,o.zw)((s.count*s.price).toFixed(2)),1)])),[[e.F8,l.showProducts.includes(s._id)]]))),128)),l.showFold?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"fold",onClick:c[0]||(c[0]=(...s)=>l.productHiddenChange&&l.productHiddenChange(...s))},[(0,a.Uk)("共计"+(0,o.zw)(Object.keys(l.products).length)+"件/1.4kg ",1),(0,a._)("span",{class:"iconfont",innerHTML:l.foldIcon?"":""},null,8,g)])):(0,a.kq)("",!0)])])]),(0,a._)("div",f,[(0,a._)("div",y,[(0,a.Uk)(" 实付金额 "),(0,a._)("b",null,"¥"+(0,o.zw)(l.totalPrice),1)]),(0,a._)("button",{class:"submit",onClick:c[1]||(c[1]=(...s)=>l.submitClick&&l.submitClick(...s))},"提交订单")]),(0,a.wy)((0,a._)("div",S,[(0,a.wy)((0,a._)("div",I,[b,M,(0,a._)("div",H,[(0,a._)("button",{class:"cancle",onClick:c[2]||(c[2]=(...s)=>l.cancleClick&&l.cancleClick(...s))},"取消订单"),(0,a._)("button",{onClick:c[3]||(c[3]=()=>l.payClick(l.shopId,l.products))},"确认支付")])],512),[[e.F8,!l.paySuccess]]),(0,a.wy)((0,a._)("div",L,[(0,a._)("div",{class:"iconfont exit",onClick:c[4]||(c[4]=()=>l.exitClick(l.router))},""),z,F],512),[[e.F8,l.paySuccess]])],512),[[e.F8,l.mask]]),l.show?((0,a.wg)(),(0,a.j4)(A,{key:0,toastMessa:l.toastMessa},null,8,["toastMessa"])):(0,a.kq)("",!0)])}t(7658);var T=t(7086),D=t(2131),A=t(2201),U=t(2262),j=t(3907),x=t(1117),N=t(2186);const Z=(s,c)=>{s.commit("submitOrder",{orderInfo:c})},q=(s,c,t,a)=>{const o=(0,U.iH)(!1),e=(0,U.iH)(!1),l=()=>{o.value=!0},n=()=>{o.value=!1},i=async(c,t)=>{const o=[],l=[];for(const s in t){const c=t[s];o.push({id:c._id,name:c.name}),l.push({orderSales:c.count,product:{name:c.name,img:c.imgUrl,price:c.price,sales:c.sales}})}try{const t=await(0,x.v_)("/api/order",{addressId:"上海大学延长校区行健楼10层技园2号楼10层",shopId:c,shopName:c,isCanceled:!1,products:o});0===t?.errno?e.value=!0:s("提交订单失败")}catch(i){s("提交订单失败")}const n={address:"上海大学延长校区行健楼10层技园2号楼10层",shopId:c,shopName:c,isCanceled:!1,products:l};Z(a,n)},r=s=>{o.value=!1,e.value=!1,s.push({name:"OrderList"}),c(t)};return{submitClick:l,cancleClick:n,payClick:i,exitClick:r,mask:o,paySuccess:e}},O=s=>{const c=(0,U.iH)(!1),t=(0,U.iH)(!0),a=Object.keys(s),o=(0,U.iH)(a);a.length>2&&(c.value=!0,o.value=a.slice(0,2));const e=()=>{t.value?o.value=a:o.value=a.slice(0,2),t.value=!t.value};return{showFold:c,showProducts:o,foldIcon:t,productHiddenChange:e}};var K={name:"OrderConfirmation",components:{Toast:N.Z},setup(){const s=(0,A.tv)(),c=(0,A.yj)(),t=c.params.id,a=(0,j.oR)(),{cartList:o}=(0,T.r)(),e=o.value[t],{calculate:l,clearAll:n}=(0,D.F)(t,e),i=l.value.totalPrice,{show:r,toastMessa:d,showToast:u}=(0,N.S)(),{submitClick:h,cancleClick:p,payClick:_,exitClick:k,mask:v,paySuccess:C}=q(u,n,t,a),{showFold:w,productHiddenChange:m,foldIcon:g,showProducts:f}=O(e);return{shopId:t,products:e,totalPrice:i,submitClick:h,cancleClick:p,payClick:_,exitClick:k,mask:v,paySuccess:C,show:r,toastMessa:d,router:s,showFold:w,foldIcon:g,productHiddenChange:m,showProducts:f}}},R=t(3744);const Y=(0,R.Z)(K,[["render",P],["__scopeId","data-v-71024647"]]);var B=Y},2131:function(s,c,t){t.d(c,{Z:function(){return x},F:function(){return T}});var a=t(6252),o=t(3577),e=t(9963);const l=s=>((0,a.dD)("data-v-e3faf984"),s=s(),(0,a.Cn)(),s),n={key:1,class:"product"},i={class:"product__state"},r={class:"product__state__selectall"},d=["innerHTML"],u=["innerHTML","onClick"],h=["src"],p={class:"info"},_={class:"price"},k={class:"price__now"},v={class:"price__origin"},C={class:"number"},w=["onClick"],m=["onClick"],g={class:"bottom"},f=l((()=>(0,a._)("img",{src:"http://www.dell-lee.com/imgs/vue3/basket.png",alt:""},null,-1))),y={class:"tag"},S={class:"bottom__allprice"},I={class:"price"};function b(s,c,t,l,b,M){const H=(0,a.up)("Toast");return(0,a.wg)(),(0,a.iD)(a.HY,null,[l.showCartList&&l.calculate.totalNum>0?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"mask",onClick:c[0]||(c[0]=(...s)=>l.handleShowCartlist&&l.handleShowCartlist(...s))})):(0,a.kq)("",!0),l.showCartList&&l.calculate.totalNum>0?((0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",i,[(0,a._)("div",r,[(0,a._)("span",{class:"icon iconfont",innerHTML:l.calculate.allSelectd?"":"",onClick:c[1]||(c[1]=()=>{l.changeSelectAllState(l.shopId)})},null,8,d),(0,a.Uk)(" 全选 ")]),(0,a._)("div",{class:"product__state__cleanall",onClick:c[2]||(c[2]=()=>{l.clearAll(l.shopId)})}," 清空购物车 ")]),(0,a._)("ul",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.product,(s=>(0,a.wy)(((0,a.wg)(),(0,a.iD)("li",{key:s._id},[(0,a._)("div",{class:"iconfont check",innerHTML:s.check?"":"",onClick:()=>l.changeProductCheck(l.shopId,s._id)},null,8,u),(0,a._)("img",{src:s.imgUrl,alt:""},null,8,h),(0,a._)("div",p,[(0,a._)("h3",null,(0,o.zw)(s.name),1),(0,a._)("div",_,[(0,a._)("div",k,(0,o.zw)(s.price),1),(0,a._)("div",v,(0,o.zw)(s.oldPrice),1)])]),(0,a._)("div",C,[(0,a._)("span",{class:"number__minus",onClick:()=>{l.changeCount(l.shopId,s._id,s,-1)}},"-",8,w),(0,a.Uk)((0,o.zw)(s.count||0)+" ",1),(0,a._)("span",{class:"number__add",onClick:()=>{l.changeCount(l.shopId,s._id,s,1)}},"+",8,m)])])),[[e.F8,s.count>0]]))),128))])])):(0,a.kq)("",!0),(0,a._)("div",g,[(0,a._)("div",{class:"bottom__basket",onClick:c[3]||(c[3]=(...s)=>l.handleShowCartlist&&l.handleShowCartlist(...s))},[f,(0,a._)("div",y,(0,o.zw)(l.calculate.totalNum),1)]),(0,a._)("div",S,[(0,a.Uk)(" 总计："),(0,a._)("span",I,"¥"+(0,o.zw)(l.calculate.totalPrice),1)]),(0,a._)("div",{class:"bottom__check",onClick:c[4]||(c[4]=(...s)=>l.checkClick&&l.checkClick(...s))},"去结算")]),l.show?((0,a.wg)(),(0,a.j4)(H,{key:2,toastMessa:l.toastMessa},null,8,["toastMessa"])):(0,a.kq)("",!0)],64)}t(7658);var M=t(2262),H=t(2201),L=t(3907),z=t(7086),F=t(2186);const P=(s,c)=>{const t=(0,H.tv)(),{show:a,toastMessa:o,showToast:e}=(0,F.S)(),l=()=>{"{}"===JSON.stringify(s.value)?e("请至少添加一种添加商品!"):t.push({path:`/orderConfirmation/${c}`})};return{checkClick:l,show:a,toastMessa:o}},T=(s,c)=>{const t=(0,L.oR)(),o=t.state.cartList,e=(0,a.Fl)((()=>{const t=o[s];let a=0,e=0,l=!0;if(t)for(const s in t){const c=t[s];a+=c.count,c.check&&(e+=c.count*c.price),c.check||(l=!1)}return a<=0&&(c.value=!1),e=e.toFixed(2),{totalNum:a,totalPrice:e,allSelectd:l}})),l=(0,a.Fl)((()=>{const c=o[s]||{};return c})),{changeCount:n}=(0,z.r)(),i=(s,c)=>{t.commit("changeProductCheck",{shopId:s,productId:c})},r=s=>{t.commit("changeSelectAllState",{shopId:s})},d=s=>{t.commit("clearAll",{shopId:s})};return{calculate:e,product:l,changeCount:n,changeProductCheck:i,changeSelectAllState:r,clearAll:d}},D=()=>{const s=(0,M.iH)(!1),c=()=>{s.value=!s.value};return{showCartList:s,handleShowCartlist:c}};var A={name:"ShopCart",components:{Toast:F.Z},setup(){const s=(0,H.yj)(),c=s.params.id,{showCartList:t,handleShowCartlist:a}=D(),{calculate:o,product:e,changeCount:l,changeProductCheck:n,changeSelectAllState:i,clearAll:r}=T(c,t),{checkClick:d,show:u,toastMessa:h}=P(e,c);return{calculate:o,product:e,shopId:c,showCartList:t,changeCount:l,changeProductCheck:n,changeSelectAllState:i,clearAll:r,handleShowCartlist:a,checkClick:d,show:u,toastMessa:h}}},U=t(3744);const j=(0,U.Z)(A,[["render",b],["__scopeId","data-v-e3faf984"]]);var x=j}}]);
//# sourceMappingURL=orderConfirmation.f402cca1.js.map